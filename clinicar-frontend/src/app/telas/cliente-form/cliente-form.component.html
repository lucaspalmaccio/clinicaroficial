<div class="form-container">
  <!-- Adicionado #clienteForm="ngForm" para controlo de validação -->
  <form (ngSubmit)="salvar()" #clienteForm="ngForm" class="data-form">
    <header class="form-header">
      <h2>{{ isEditMode ? 'Editar Cliente' : 'Adicionar Novo Cliente' }}</h2>
      <p>Preencha as informações do cliente abaixo.</p>
    </header>

    <div class="form-grid">
      <div class="form-group">
        <label for="nome">Nome Completo</label>
        <input type="text" id="nome" [(ngModel)]="cliente.nome" name="nome" required placeholder="Ex: João da Silva" #nomeInput="ngModel">
        <div *ngIf="nomeInput.invalid && (nomeInput.dirty || nomeInput.touched)" class="validation-error">
          O nome é obrigatório.
        </div>
      </div>

      <div class="form-group">
        <label for="cpf">CPF</label>
        <input type="text" id="cpf" [(ngModel)]="cliente.cpf" name="cpf" required placeholder="000.000.000-00" appCpfMask maxlength="14" #cpfInput="ngModel">
        <div *ngIf="cpfInput.invalid && (cpfInput.dirty || cpfInput.touched)" class="validation-error">
          O CPF é obrigatório.
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" [(ngModel)]="cliente.email" name="email" required email #emailInput="ngModel" placeholder="email@exemplo.com">
        <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="validation-error">
          Por favor, insira um e-mail válido.
        </div>
      </div>

      <div class="form-group">
        <label for="telefone">Telefone</label>
        <input type="text" id="telefone" [(ngModel)]="cliente.telefone" name="telefone" required placeholder="(11) 99999-9999" appTelefoneMask maxlength="15" #telefoneInput="ngModel">
        <div *ngIf="telefoneInput.invalid && (telefoneInput.dirty || telefoneInput.touched)" class="validation-error">
          O telefone é obrigatório.
        </div>
      </div>

      <div class="form-group">
        <label for="cep">CEP</label>
        <!-- ATUALIZAÇÃO: Adicionado o evento (blur) para chamar a função de busca -->
        <input type="text" id="cep" [(ngModel)]="cliente.cep" name="cep" required placeholder="00000-000" appCepMask maxlength="9" (blur)="buscarCep()" #cepInput="ngModel">
        <div *ngIf="cepInput.invalid && (cepInput.dirty || cepInput.touched)" class="validation-error">
          O CEP é obrigatório.
        </div>
      </div>

      <div class="form-group">
        <label for="logradouro">Logradouro</label>
        <input type="text" id="logradouro" [(ngModel)]="cliente.logradouro" name="logradouro" required placeholder="Rua, Avenida, etc.">
      </div>

      <div class="form-group">
        <label for="bairro">Bairro</label>
        <input type="text" id="bairro" [(ngModel)]="cliente.bairro" name="bairro" required placeholder="Nome do bairro">
      </div>

      <div class="form-group">
        <label for="cidade">Cidade</label>
        <input type="text" id="cidade" [(ngModel)]="cliente.cidade" name="cidade" required placeholder="Nome da cidade">
      </div>

      <div class="form-group">
        <label for="uf">UF</label>
        <input type="text" id="uf" [(ngModel)]="cliente.uf" name="uf" required maxlength="2" placeholder="SP">
      </div>
    </div>

    <!-- ATUALIZAÇÃO: Adicionado um local para exibir a mensagem de erro -->
    <div *ngIf="mensagemErro" class="alert alert-danger mt-3">
      {{ mensagemErro }}
    </div>

    <footer class="form-actions">
      <button type="button" class="btn btn-secondary" routerLink="/clientes">Cancelar</button>
      <button type="submit" class="btn btn-primary" [disabled]="clienteForm.invalid">Salvar Cliente</button>
    </footer>
  </form>
</div>

